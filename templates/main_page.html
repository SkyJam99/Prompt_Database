<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Prompt Database</title>
        <meta charset="UTF-8">
        <meta name="author" content="Riley Meyers">
        <meta name="last modified" content="28/01/2024">
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script src="https://code.jquery.com/jquery-3.7.0.js"></script>

    </head>

        <body>
        <div class="bg-dark text-light">
            <div class="container-fluid text-center">
                <div class="row">
                    <div class="col-sm-12">
                        <h1>Prompt Database</h1>
                        <!-- Add new prompt form -->
                        <form id="createPromptForm">
                            <input type="text" id="newPromptText" placeholder="Enter new prompt">
                            <button type="submit" class="btn btn-primary">Add Prompt</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-12">
                        <button id="refreshData" class="btn btn-info">Refresh Prompts</button>
                        <div id='results'>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function jsonToHtmlTable(jsonData) {
                // Check if jsonData is empty
                if (jsonData.length === 0) {
                    return "<p>No data available</p>";
                }

                // Start building the table
                let tableHtml = "<table border='1'><thead><tr>";

                // Extract headings (keys of the JSON objects)
                Object.keys(jsonData[0]).forEach(key => {
                    tableHtml += `<th>${key}</th>`;
                });
                tableHtml += "</tr></thead><tbody>";

                // Populate the table rows with the JSON data
                jsonData.forEach(item => {
                    tableHtml += "<tr>";
                    Object.values(item).forEach(value => {
                        tableHtml += `<td>${value}</td>`;
                    });
                    tableHtml += "</tr>";
                });

                // Close the table tags
                tableHtml += "</tbody></table>";

                return tableHtml;
            }


            function getAllPrompts() {
                console.log("Trying to get all prompts");
                $.ajax({
                    url: '/prompt',
                    type: 'GET',
                    success: function(data) {
                        console.log(data);
                        var promptsHtml = jsonToHtmlTable(data)
                        $('#results').html(promptsHtml);
                    },
                    error: function(xhr, status, error) {
                        $('#results').html("Error: " + error);
                    }
                });
            }

            $(document).ready(function() {
                getAllPrompts();
            });

            // Refresh button
            $("#refreshData").click(function() {
                $('#results').html('')
                getAllPrompts();
            });
        </script>
    </body>
</html>